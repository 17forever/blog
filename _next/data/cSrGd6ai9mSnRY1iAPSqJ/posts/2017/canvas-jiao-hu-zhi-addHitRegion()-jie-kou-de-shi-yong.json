{"pageProps":{"id":["2017","canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong"],"name":"canvas交互之addHitRegion()接口的使用","data":{"date":"2017-02-16","body":"这段时间研究 canvas，在交互这里遇到了比较大的坑。\n\n据我目前所知，canvas 纳入标准的常用交互接口（可能也就这一个）是 `isPointInPath()` ，它可以判断 js 设置的事件条件是否处于当前绘图路径中，或者说最后一个路径，具体使用如下\n\n```js\n//获取鼠标指针坐标\nfunction getMousePos(evt) {\n  var rect = document.getElementById('canvas').getBoundingClientRect()\n  return {\n    x: evt.clientX - rect.left,\n    y: evt.clientY - rect.top,\n  }\n}\n\ndocument.getElementById(selector).addEventListener(\n  'click',\n  function (evt) {\n    var mousePos = getMousePos(evt)\n    if (context.isPointInPath(mousePos.x, mousePos.y)) {\n      //重绘\n    }\n  },\n  false,\n)\n```\n\n由于 canvas 不保存绘图路径，绘完了就 bia 在页面上，成死的了，因此无法对最后一条路径之前的路径重新拿出来处理。那么传统方法如何处理？--重绘，再针对每一个绘图路径使用 `isPointInPath()` 判断，核心代码使用如下（来自[脚儿网](http://jo2.org/html5-canvas-ispointinpath/)，谢谢作者）\n\n```js\n ...\n function draw () {\n // ...\n }\n function circle () {\n // ...\n }\n\n draw();\n ctx.fill()\n circle();\n ctx.fill()\n\n var fns = [draw,circle];\n cvs.onmousemove = function (e) {\n   var x = e.offsetX, y = e.offsetY;\n   ctx.clearRect(0,0,400,300)\n   for(var i = fns.length;i--;) {\n     fns[i]();\n     if(ctx.isPointInPath(x,y)) {\n       ctx.fillStyle = \"#f00\"\n     } else {\n       ctx.fillStyle = \"#000\"\n     }\n     ctx.fill()\n   }\n }\n```\n\ncanvas 只有一张画布，对之前任何一个路径作刷新，需要重绘所有受到影响的路径，因此，当需要重绘的动作越来越多时，就会对性能造成极大考验。作为 HTML5 的新宠儿，不应就此中道崩殂，我们也不想写如上略显累赘的代码。今天在查阅资料后，发现一个尚在讨论的新接口 `addHitRegion()` [MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/addHitRegion)，使用简单而且可以实现良好的交互效果，目前在 chrome 和 firefox 下测试可用（需要在 chrome://flags 中启用【实验性画布功能】或在 firefox 中输入 about:config 使 canvas.hitregions.enabled 值为 true）\n\n具体使用如下\n\n绘图时在需要添加交互事件的路径中添加如下代码\n\n```js\ntry {\n  //id为空会报错\n  ctx.addHitRegion({ id: 'excited' })\n} catch (e) {\n  alert(\n    '请在chrome://flags中启用【实验性画布功能】或在firefox中输入about:config使canvas.hitregions.enabled值为true以开启更多功能~~~///(^v^)\\\\~~~',\n  )\n}\n```\n\n需要注意的是 id 的值不能为空\n\n然后，这样引用\n\n```js\n document.getElementById(selector).addEventListener('click', function (event) {\n     if (event.region === 'excited') {\n         ...\n     }\n }, false);\n```\n\n相当于把需要的路径标识出来后面使用，非常方便。\n\n注意：该接口目前尚在实验中，在未来版本的浏览器中其语法和行为可能有所改变。未纳入标准之前，可以玩玩\n\ndemo: https://17forever.github.io/canvas-demo/client/"},"allPosts":[{"date":"2021","list":[{"name":"绩效约谈后有感","date":"2021-02-24","path":"ji-xiao-yue-tan-hou-you-gan","groupDate":"2021"},{"name":"面对人生选择","date":"2021-02-20","path":"mian-dui-ren-sheng-xuan-ze","groupDate":"2021"},{"name":"我的生日","date":"2021-01-27","path":"wo-de-sheng-ri","groupDate":"2021"},{"name":"2021年初的一点思考","date":"2021-01-20","path":"2021-nian-chu-de-yi-dian-si-kao","groupDate":"2021"}]},{"date":"2020","list":[{"name":"win10下使用wls2和vscode配置超级舒服的开发环境 ","date":"2020-11-29","path":"win10-xia-shi-yong-wls2-he-vscode-pei-zhi-chao-ji-shu-fu-de-kai-fa-huan-jing","groupDate":"2020"},{"name":"Termux玩法","date":"2020-10-19","path":"Termux-wan-fa","groupDate":"2020"},{"name":"nextjs-with-styled-components-fluent-ui","date":"2020-09-03","path":"nextjs-with-styled-components-fluent-ui","groupDate":"2020"},{"name":"脂肪肝","date":"2020-08-30","path":"zhi-fang-gan","groupDate":"2020"}]},{"date":"2018","list":[{"name":"两个口袋","date":"2018-05-06","path":"liang-ge-kou-dai","groupDate":"2018"}]},{"date":"2017","list":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du","groupDate":"2017"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji","groupDate":"2017"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong","groupDate":"2017"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji","groupDate":"2017"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian","groupDate":"2017"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu","groupDate":"2017"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan","groupDate":"2017"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong","groupDate":"2017"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li","groupDate":"2017"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi","groupDate":"2017"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan","groupDate":"2017"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong","groupDate":"2017"}]},{"date":"2015","list":[{"name":"学车随笔","date":"2015-08-21","path":"xue-che-sui-bi","groupDate":"2015"},{"name":"怀念我的部长-刘高","date":"2015-04-10","path":"huai-nian-wo-de-bu-chang---liu-gao","groupDate":"2015"}]}],"datePosts":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong"}]},"__N_SSG":true}