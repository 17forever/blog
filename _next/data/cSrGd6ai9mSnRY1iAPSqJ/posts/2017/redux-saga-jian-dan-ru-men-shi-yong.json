{"pageProps":{"id":["2017","redux-saga-jian-dan-ru-men-shi-yong"],"name":"redux-saga简单入门使用","data":{"date":"2017-05-08","body":"redux 架构中，如果 action 里有诸如网络请求、磁盘读写等异步操作，会提示使用中间件解决。redux-saga 可以用来做这件事。项目引入 redux-saga 后，可以让 action 做纯粹的 action，一些有副作用的 action 交给 saga 管理。\n这里介绍一个比较常用的情况，用 fetch 从服务端请求数据。\n\n在管理 action 处会用到 redux-saga 中的以下接口：\n\n- call，至少接受一个方法名，比如调用 fetch 方法\n- put，相当于 redux 中的 dispatch\n- takeEvery，接受一个 action 和方法名，全局环境下时刻监听，只要 dispatch 这个 action，便会执行相应的方法\n\n相应代码如下：\n\nimport\n\n```js\nimport { call, put, takeEvery } from 'redux-saga/effects'\n```\n\nfetch\n\n```js\nfunction fetchAPI() {\n  return fetch(fetchUrl)\n    .then((res) => res.json())\n    .then((resJson) => resJson)\n    .catch((err) => err.message)\n    .done()\n}\n```\n\n异步处理(async 以同步形式写异步)\n\n```js\nfunction* fetchUser() {\n  try {\n    const response = yield call(fetchAPI)\n    // 或者\n    // const response = yield call( fetch, fetchUrl );\n\n    // 将上一步调用fetch得到的结果作为某action的参数dispatch，对应saga的put\n    yield put({ type: 'RECEIVE_DATA_SUCCESS', data: response })\n  } catch (error) {\n    yield put(fetchFailure())\n  }\n}\n```\n\n注册监听函数\n\n```js\nexport default function* event() {\n  // 一旦'FETCH_DATA_REQUEST'在别处被dispatch，会立即调用fetchUser这个函数，fetchUser再调用fetch，做异步处理后完成相应动作，比如成功就dispatch 'RECEIVE_DATA_SUCCESS'，进而在reducer中更新state\n  yield takeEvery('FETCH_DATA_REQUEST', fetchUser)\n}\n```\n\n以上是一个简单的 redux-saga 处理 fetch 请求的操作，最后，需要在 createStore 这里注册中间件才能使用。\n\n需要引入导出的监听函数，并在 store 生成后 run 这个函数\n\n```js\n'use strict'\n\n// Redux\nimport { applyMiddleware, combineReducers, createStore } from 'redux'\nimport logger from 'redux-logger'\n\n// redux saga\nimport createSagaMiddleware from 'redux-saga'\n// 引入导出的监听函数\nimport rootSaga from '../sagas/index'\n// create the saga middleware\nconst sagaMiddleware = createSagaMiddleware()\n\nconst store = createStore(\n  combineReducers({\n    ...reducers,\n  }),\n  applyMiddleware(sagaMiddleware, logger),\n)\n\nsagaMiddleware.run(rootSaga)\n\nexport default store\n```"},"allPosts":[{"date":"2021","list":[{"name":"绩效约谈后有感","date":"2021-02-24","path":"ji-xiao-yue-tan-hou-you-gan","groupDate":"2021"},{"name":"面对人生选择","date":"2021-02-20","path":"mian-dui-ren-sheng-xuan-ze","groupDate":"2021"},{"name":"我的生日","date":"2021-01-27","path":"wo-de-sheng-ri","groupDate":"2021"},{"name":"2021年初的一点思考","date":"2021-01-20","path":"2021-nian-chu-de-yi-dian-si-kao","groupDate":"2021"}]},{"date":"2020","list":[{"name":"win10下使用wls2和vscode配置超级舒服的开发环境 ","date":"2020-11-29","path":"win10-xia-shi-yong-wls2-he-vscode-pei-zhi-chao-ji-shu-fu-de-kai-fa-huan-jing","groupDate":"2020"},{"name":"Termux玩法","date":"2020-10-19","path":"Termux-wan-fa","groupDate":"2020"},{"name":"nextjs-with-styled-components-fluent-ui","date":"2020-09-03","path":"nextjs-with-styled-components-fluent-ui","groupDate":"2020"},{"name":"脂肪肝","date":"2020-08-30","path":"zhi-fang-gan","groupDate":"2020"}]},{"date":"2018","list":[{"name":"两个口袋","date":"2018-05-06","path":"liang-ge-kou-dai","groupDate":"2018"}]},{"date":"2017","list":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du","groupDate":"2017"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji","groupDate":"2017"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong","groupDate":"2017"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji","groupDate":"2017"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian","groupDate":"2017"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu","groupDate":"2017"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan","groupDate":"2017"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong","groupDate":"2017"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li","groupDate":"2017"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi","groupDate":"2017"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan","groupDate":"2017"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong","groupDate":"2017"}]},{"date":"2015","list":[{"name":"学车随笔","date":"2015-08-21","path":"xue-che-sui-bi","groupDate":"2015"},{"name":"怀念我的部长-刘高","date":"2015-04-10","path":"huai-nian-wo-de-bu-chang---liu-gao","groupDate":"2015"}]}],"datePosts":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong"}]},"__N_SSG":true}