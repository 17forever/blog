{"pageProps":{"id":["2017","python-pa-chong-chu-ti-yan"],"name":"python爬虫初体验","data":{"date":"2017-06-03","body":"之前用 nodejs 爬过 instagram，StackOverflow 和 segmentfault，使用的模拟登录方式。爬微博时由于主机在韩国止于验证码，今天试用 Python 写爬虫，总结如下\n\n> python 版本：3.6\n> 使用内置`urllib`做 HTTP 代理\n> DOM 解析用`BeautifulSoup`和`lxml`，相当于 nodejs 的`cheerio`\n\n```py\n# HTTP代理模块\nimport urllib.request\nimport urllib.error\n\n# DOM解析模块\n# from bs4 import BeautifulSoup\nimport lxml.html\nimport lxml.cssselect\n\n# 写入csv文件模块\nimport csv\n\nurl = 'http://example.webscraping.com'\n\n# url = 'http://localhost:3000'\n# user_agent = 'custom'\n# headers = {'User-Agent': user_agent}\n\n\ndef download(url):\n    print('Download: ' + url)\n    try:\n        html = urllib.request.urlopen(url).read().decode('utf8')\n\n        # 加用户代理User-Agent\n        # html = urllib.request.urlopen(urllib.request.Request(url, headers=headers))\n\n    except urllib.error.URLError as e:\n        print('Download error: ' + e.reason)\n        html = None\n    return html\n\n# 使用BeautifulSoup\n# html = download(url)\n# soup = BeautifulSoup(html)\n# result = soup.find(attrs={'id', 'results'})\n\n# 使用lxml\n# tree = lxml.html.fromstring(download(url)).cssselect('#results')[0].text_content()\ntree = lxml.html.fromstring(download(url)).cssselect('#results a')\n\n# 写入到文件\n# newline=''是为防止出现空白行\ncsv_file = csv.writer(open('data.csv', 'w', newline=''))\ncsv_file.writerow(['country'])\n\nfor country in tree:\n    csv_file.writerow([country.text_content()])\n\nprint('ok')\n\n\n```\n\n其中\n\n1. download 函数中注释的部分为自定义用户代理，默认为 Python-urllib/版本号\n2. `BeautifulSoup`和`lxml.html.fromstring`均有将不规范的 html 代码补充完善的功能\n3. lxml 可使用类似于 css 选择器的功能操作 DOM，但是需要单独安装`cssselect`这个模块\n4. 与 css 选择器不同的是，选择 id 仍需要数组下标[0]唯一指定\n5. lxml 的性能比 BeautifulSoup 快得多\n6. csv 的 writerow 参数为可迭代参数，为数组则迭代数组项，为字符串则迭代字符串每一项\n7. 不要忘记`newline=\"\"`，可防止出现写入到文件中的隔行空白。"},"allPosts":[{"date":"2021","list":[{"name":"绩效约谈后有感","date":"2021-02-24","path":"ji-xiao-yue-tan-hou-you-gan","groupDate":"2021"},{"name":"面对人生选择","date":"2021-02-20","path":"mian-dui-ren-sheng-xuan-ze","groupDate":"2021"},{"name":"我的生日","date":"2021-01-27","path":"wo-de-sheng-ri","groupDate":"2021"},{"name":"2021年初的一点思考","date":"2021-01-20","path":"2021-nian-chu-de-yi-dian-si-kao","groupDate":"2021"}]},{"date":"2020","list":[{"name":"win10下使用wls2和vscode配置超级舒服的开发环境 ","date":"2020-11-29","path":"win10-xia-shi-yong-wls2-he-vscode-pei-zhi-chao-ji-shu-fu-de-kai-fa-huan-jing","groupDate":"2020"},{"name":"Termux玩法","date":"2020-10-19","path":"Termux-wan-fa","groupDate":"2020"},{"name":"nextjs-with-styled-components-fluent-ui","date":"2020-09-03","path":"nextjs-with-styled-components-fluent-ui","groupDate":"2020"},{"name":"脂肪肝","date":"2020-08-30","path":"zhi-fang-gan","groupDate":"2020"}]},{"date":"2018","list":[{"name":"两个口袋","date":"2018-05-06","path":"liang-ge-kou-dai","groupDate":"2018"}]},{"date":"2017","list":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du","groupDate":"2017"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji","groupDate":"2017"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong","groupDate":"2017"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji","groupDate":"2017"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian","groupDate":"2017"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu","groupDate":"2017"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan","groupDate":"2017"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong","groupDate":"2017"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li","groupDate":"2017"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi","groupDate":"2017"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan","groupDate":"2017"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong","groupDate":"2017"}]},{"date":"2015","list":[{"name":"学车随笔","date":"2015-08-21","path":"xue-che-sui-bi","groupDate":"2015"},{"name":"怀念我的部长-刘高","date":"2015-04-10","path":"huai-nian-wo-de-bu-chang---liu-gao","groupDate":"2015"}]}],"datePosts":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong"}]},"__N_SSG":true}