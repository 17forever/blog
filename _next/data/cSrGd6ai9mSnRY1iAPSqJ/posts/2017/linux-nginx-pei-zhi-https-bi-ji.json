{"pageProps":{"id":["2017","linux-nginx-pei-zhi-https-bi-ji"],"name":"linux nginx配置https笔记","data":{"date":"2017-09-23","body":"> 前提：nginx 已启动\n> 主机环境：ubuntu 16.04\n\n使用的 ssl 证书为 Lets's Encrypt Authority x3 签发的，是免费使用的，他们的工具现在叫 certbot，使用方法很简单，按[这一套](https://certbot.eff.org/#ubuntuxenial-nginx)流程下来，https 就就可以正常使用了，非常方便。\n\n主要记录一下几个要点\n\n- 多个子域需要各自生成证书，比如 example.com、a.example.com、b.example.com 就需要三个证书，终端用这一条命令搞定：\n  `sudo certbot --expand -d example.com,a.example.com,b.example.com`\n\n- 接下来会让你选这个：\n  ```\n  > Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.\n  > 1: No redirect - Make no further changes to the webserver configuration.\n  > 2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for\n  > new sites, or if you're confident your site works on HTTPS. You can undo this\n  > change by editing your web server's configuration.\n  ```\n\n**假如你有很多子域，或设置了泛解析，并且没有分别为每个子域分配证书**\n\n- 如果选择了 1，nginx 不会对非 https 请求作重定向。添加了证书的子域，如果用户输入 http 进入还是按照 http 做请求，未添加证书的子域也还是按照 http 来链接(80 端口)，对用户的体验没有影响。\n- 如果选择了 2，会在 nginx 配置文件中加入一个 http => hhtps 的强制重定向操作。那么在访问没有证书的子域时，会出现这个界面（你的连接不安全，需要在**高级**中点继续访问），不过这个子域在连接时仍然使用的 443 端口，这在你将某一没有证书的子域作为 restfulAPI 服务时对一些强制需要 https 的网站很有用，比如小程序，比如苹果。\n\n![TIM截图20170923130244.png](http://upload-images.jianshu.io/upload_images/864719-ed5f64698653ca91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n其实 2 比 1 在 nginx 中就多了这么几行，注释掉和 1 的作用相同\n\n![TIM截图20170923134624.png](http://upload-images.jianshu.io/upload_images/864719-70d45f5dd24cebde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n在 nginx 这里，最好将每一子域分开写，我写的`*.example.com`，在更新证书时提示没有找到`www.`这个子域，但是感觉这样不合理，应该是可以批量配置的。"},"allPosts":[{"date":"2021","list":[{"name":"绩效约谈后有感","date":"2021-02-24","path":"ji-xiao-yue-tan-hou-you-gan","groupDate":"2021"},{"name":"面对人生选择","date":"2021-02-20","path":"mian-dui-ren-sheng-xuan-ze","groupDate":"2021"},{"name":"我的生日","date":"2021-01-27","path":"wo-de-sheng-ri","groupDate":"2021"},{"name":"2021年初的一点思考","date":"2021-01-20","path":"2021-nian-chu-de-yi-dian-si-kao","groupDate":"2021"}]},{"date":"2020","list":[{"name":"win10下使用wls2和vscode配置超级舒服的开发环境 ","date":"2020-11-29","path":"win10-xia-shi-yong-wls2-he-vscode-pei-zhi-chao-ji-shu-fu-de-kai-fa-huan-jing","groupDate":"2020"},{"name":"Termux玩法","date":"2020-10-19","path":"Termux-wan-fa","groupDate":"2020"},{"name":"nextjs-with-styled-components-fluent-ui","date":"2020-09-03","path":"nextjs-with-styled-components-fluent-ui","groupDate":"2020"},{"name":"脂肪肝","date":"2020-08-30","path":"zhi-fang-gan","groupDate":"2020"}]},{"date":"2018","list":[{"name":"两个口袋","date":"2018-05-06","path":"liang-ge-kou-dai","groupDate":"2018"}]},{"date":"2017","list":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du","groupDate":"2017"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji","groupDate":"2017"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong","groupDate":"2017"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji","groupDate":"2017"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian","groupDate":"2017"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu","groupDate":"2017"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan","groupDate":"2017"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong","groupDate":"2017"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li","groupDate":"2017"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi","groupDate":"2017"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan","groupDate":"2017"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong","groupDate":"2017"}]},{"date":"2015","list":[{"name":"学车随笔","date":"2015-08-21","path":"xue-che-sui-bi","groupDate":"2015"},{"name":"怀念我的部长-刘高","date":"2015-04-10","path":"huai-nian-wo-de-bu-chang---liu-gao","groupDate":"2015"}]}],"datePosts":[{"name":"JavaScript50行代码暴力生成9x9数独","date":"2017-10-12","path":"JavaScript50-hang-dai-ma-bao-li-sheng-cheng-9x9-shu-du"},{"name":"域名解析小记","date":"2017-09-23","path":"yu-ming-jie-xi-xiao-ji"},{"name":"nginx作用","date":"2017-09-23","path":"nginx-zuo-yong"},{"name":"linux nginx配置https笔记","date":"2017-09-23","path":"linux-nginx-pei-zhi-https-bi-ji"},{"name":"React Material-UI笔记-theme篇","date":"2017-09-20","path":"React-Material-UI-bi-ji--theme-pian"},{"name":"js异步之callback简述","date":"2017-07-07","path":"js-yi-bu-zhi-callback-jian-shu"},{"name":"python爬虫初体验","date":"2017-06-03","path":"python-pa-chong-chu-ti-yan"},{"name":"redux-saga简单入门使用","date":"2017-05-08","path":"redux-saga-jian-dan-ru-men-shi-yong"},{"name":"react-native触摸和动画实例","date":"2017-05-06","path":"react-native-chu-mo-he-dong-hua-shi-li"},{"name":"react技术栈学习","date":"2017-02-27","path":"react-ji-shu-zhan-xue-xi"},{"name":"es6 export和import相关","date":"2017-02-26","path":"es6-export-he-import-xiang-guan"},{"name":"canvas交互之addHitRegion()接口的使用","date":"2017-02-16","path":"canvas-jiao-hu-zhi-addHitRegion()-jie-kou-de-shi-yong"}]},"__N_SSG":true}